{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>
<body>
    {% include "heading.html" %}
    <div class="flex_column">
        <div class="delivery_list" id="deliveryList">

        </div>    

        <a href="../deliveryForm">Create a delivery</a>
    </div>
    
    <script>
        function clearMessage() {
            document.getElementById('message').innerText = ''; // Clear the message
        }

        function dragstartHandler(event) {
            // event.target is the element being dragged
            event.dataTransfer.setData('text/plain', event.target.seq);
        }

        function handleDrop(event) {
            event.preventDefault(); // Prevents default behavior (e.g., opening a dropped file)
            // Handle the drop event here (e.g., get data from the dragged element)
            // event.target is the drop target.
            // console.log('Dropped:', event.dataTransfer.getData('text/plain')); 
            console.log('element being dropped: ', event.dataTransfer.getData('text/plain'))
            console.log('dropped on: ', event.target.seq)
        }

        function dragOverHandler(event) {
            event.preventDefault();
            event.target.style.backgroundColor = "red"
        }

        function dragLeaveHandler(event) {
            event.preventDefault();
            event.target.style.backgroundColor = "white"
        }

        function fill() {
            const delivery_json = JSON.parse('{{ delivery_json|escapejs }}')            
            console.log("Last name is: " + delivery_json[0].lastName)

            deliveryList = document.getElementById("deliveryList")

            for(const element of delivery_json) {
                deliveryDateDiv = document.createElement("div")
                deliveryDateDiv.className = "deliveryDateDiv"
                deliveryDateDiv.innerText = element.id + " " + element.deliveryDate

                nameDiv = document.createElement("div")
                nameDiv.className = "nameDiv"
                nameDiv.innerText = element.lastName + ", " + element.firstName

                child = document.createElement("div")
                child.className = "delivery_box"
                child.id = element.id
                child.seq = element.seq
                child.setAttribute("draggable", "true")
                child.addEventListener("dragstart", dragstartHandler)
                child.appendChild(deliveryDateDiv)
                child.appendChild(nameDiv)

                deliveryList.appendChild(child)

                dropTarget = document.createElement("div")
                dropTarget.className = "dropTarget"
                dropTarget.addEventListener('drop', handleDrop);
                dropTarget.addEventListener('dragover', dragOverHandler);
                dropTarget.addEventListener('dragleave', dragLeaveHandler);
                dropTarget.seq = element.seq
                // dropTarget.innerText = "drop target"

                deliveryList.appendChild(dropTarget)
            }
        }

        fill()
    </script>     
</body>
</html>







