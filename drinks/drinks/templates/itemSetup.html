{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>Item Setup</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>
<body>

    {% include "heading.html" %}

    <div class="flex_row_middle_up">
        <div class="contentVerticallyCenter">
            <div class="flex_column">
                <div><h3>Item Setup</h3></div>
                <div><input value="Item Code" readonly><input value="Item Desc" readonly>
                        <input value="Unit per box" readonly><input value="Unit Price" readonly>
                <div id="itemDetail"></div>
                <button onclick="addRow()">Add a row</button>
                <div class="err_msg">
                    <span id="message">{{ errMsg }}</span>
                </div>
            </div>
        </div>
        <div class="separator">
        </div>

    </div>   

    <script>
        function clearMessage() {
            document.getElementById('message').innerText = ''; // Clear the message
        }

        const django_server = "https://www.roboosoft.com/"

        function fillItem() {
            fetch(django_server + "account/itemList/")
                .then(response => response.json())
                .then(data => {

                // try {
                //     prom = await fetch(django_server + "itemList/");
                // } catch(err) {
                //     console.log("fetch error: ", err.message)
                // }

                // try {
                //     jsonObj = await prom.json();
                // } catch(err) {
                //     console.log("json error: ", err.message)
                // }

                childArray = []
                for (const element of data) {
                    child = document.createElement("div")
                    child.id = element.id

                    itemCode = document.createElement("input")
                    itemCode.value = element.itemCode

                    itemDesc = document.createElement("input")
                    itemDesc.value = element.itemDesc

                    bags = document.createElement("input")
                    bags.value = element.bags

                    bagPrice = document.createElement("input")
                    bagPrice.value = element.bagPrice

                    child.appendChild(itemCode)
                    child.appendChild(itemDesc)
                    child.appendChild(bags)
                    child.appendChild(bagPrice)

                    childArray.push(child)
                }

                div = document.getElementById("itemDetail")
                div.replaceChildren(...childArray)

            })

        }

        newRowID = 1
        function addRow() {
            child = document.createElement("div")
            child.id = "new" + newRowID
            newRowID += 1

            itemCode = document.createElement("input")
            itemCode.id = "itemCode"
            itemCode.addEventListener("input", function() {
                addOrUpdate(child.id)
                console.log("child.id is: ", child.id)
            })

            itemDesc = document.createElement("input")
            itemDesc.id = "itemDesc"

            bags = document.createElement("input")
            bags.id = "bags"

            bagPrice = document.createElement("input")
            bagPrice.id = "bagPrice"

            child.appendChild(itemCode)
            child.appendChild(itemDesc)
            child.appendChild(bags)
            child.appendChild(bagPrice)

            div = document.getElementById("itemDetail")
            div.appendChild(child)

        }

        function addOrUpdate(elementId) {

        }

        fillItem()
    </script> 
</body>
</html>


