{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>Item Setup</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>
<body>

    {% include "heading.html" %}

    <div class="flex_row_middle_up">
        <div class="contentVerticallyCenter">
            <div class="flex_column">
                <div><h3>Item Setup</h3></div>
                <div><input readonly>Item Code</input><input>Item Desc</input><input>Bags?</input><input>Bags per box</input><input>Price per bag</input></div>
                <div id="itemDetail"></div>
                <button onclick="addRow()">Add a row</button>
                <div class="err_msg">
                    <span id="message">{{ errMsg }}</span>
                </div>
            </div>
        </div>
        <div class="separator">
        </div>

    </div>   

    <script>
        function clearMessage() {
            document.getElementById('message').innerText = ''; // Clear the message
        }

        const django_server = "https://www.roboosoft.com/"

        function fillItem() {
            fetch(django_server + "account/itemList/")
                .then(response => response.json())
                .then(data => {

                // try {
                //     prom = await fetch(django_server + "itemList/");
                // } catch(err) {
                //     console.log("fetch error: ", err.message)
                // }

                // try {
                //     jsonObj = await prom.json();
                // } catch(err) {
                //     console.log("json error: ", err.message)
                // }

                childArray = []
                for (const element of data) {
                    child = document.createElement("div")
                    child.id = element.id

                    itemCode = document.createElement("input")
                    itemCode.value = element.itemCode

                    itemDesc = document.createElement("input")
                    itemDesc.value = element.itemDesc

                    Q2Flag = document.createElement("input")
                    Q2Flag.value = element.quantity2Flag

                    bags = document.createElement("input")
                    bags.value = element.bags

                    bagPrice = document.createElement("input")
                    bagPrice.value = element.bagPrice

                    child.appendChild(itemCode)
                    child.appendChild(itemDesc)
                    child.appendChild(Q2Flag)
                    child.appendChild(bags)
                    child.appendChild(bagPrice)

                    childArray.push(child)
                }

                div = document.getElementById("itemDetail")
                div.replaceChildren(...childArray)

            })

        }

        newRowID = 1
        function addRow() {
            child = document.createElement("div")
            child.id = "new" + newRowID
            newRowID += 1

            itemCode = document.createElement("input")

            itemDesc = document.createElement("input")

            Q2Flag = document.createElement("input")

            bags = document.createElement("input")

            bagPrice = document.createElement("input")

            child.appendChild(itemCode)
            child.appendChild(itemDesc)
            child.appendChild(Q2Flag)
            child.appendChild(bags)
            child.appendChild(bagPrice)

            div = document.getElementById("itemDetail")
            div.appendChild(child)

        }

        fillItem()
    </script> 
</body>
</html>


